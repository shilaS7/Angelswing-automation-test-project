name: Playwright Tests
on:
  push:
    branches: [ main, master, dev, feature/* ]
  pull_request:
    branches: [ main, master, dev, feature/* ]

jobs:
  test:
    name: Run Playwright Tests
    timeout-minutes: 60
    runs-on: ubuntu-latest

    env:
       BASE_URL: https://dev.angelswing.io
       API_KEY: 'MySecretKey@123'
       NODE_ENV: Staging

    steps:
        - name: Checkout code
          uses: actions/checkout@v5

        - name: Setup Node.js
          uses: actions/setup-node@v5
          with:
            node-version: lts/*

        - name: Install dependencies
          run: npm ci
          
        - name: Install Playwright Browsers
          run: npx playwright install --with-deps

        - name: Run Playwright tests
          run: |
            npm run test:login
   #Upload the playwright report as an artifact
        - name: Upload Playwright Report Artifact
          if: ${{ !cancelled() }}
          uses: actions/upload-artifact@v4
          with:
            name: playwright-report
            path: playwright-report/
            retention-days: 30

        - name: Slack Notification
          if: always()
          uses: rtCamp/action-slack-notify@v2
          env:
            SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
            SLACK_USERNAME: "GitHub CI"
            SLACK_ICON: https://github.com/rtCamp.png?size=48
            SLACK_TITLE: "ðŸŽ­ Playwright Test Summary"
            SLACK_MESSAGE: |
             *Repository:* ${{ github.repository }}
             *Workflow:* ${{ github.workflow }}
             *Branch:* ${{ github.ref_name }}
             *Run:* https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
             *Status:* ${{ job.status }}
            SLACK_COLOR: ${{ job.status == 'success' && 'good' || (job.status == 'failure' && 'danger' || 'warning') }}
